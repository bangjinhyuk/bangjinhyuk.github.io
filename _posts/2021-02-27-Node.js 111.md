---
layout: post
title: "Node.js ì„œë²„ Android í†µì‹ (Retrofit)"
subtitle: "AWS-Node.js ì„œë²„ êµ¬ì¶• ê³µë¶€."
categories: [server - Android]
tags: [Node.js, server, Retrofit, Android, ubuntu]
date: 2021-02-19 08:00:00
background: '/img/3.jpg'
---

## aws ì„œë²„ ì™€ Android í†µì‹  [<u>ì°¸ì¡°</u>](https://m.blog.naver.com/PostView.nhn?blogId=eyeballss&logNo=221043096972&proxyReferer=https:%2F%2Fwww.google.com%2F)
#### ocr ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì‹œê°„í‘œì •ë³´ë“¤ì„ ì˜¬ë°”ë¥´ê²Œ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ê¸°ëŠ¥ ê¸°ì´ˆ ë‹¤ì§€ê¸°
* ê¹ƒì£¼ì†Œ
    + [ì•ˆë“œë¡œì´ë“œ ìŠ¤íŠœë””ì˜¤](https://github.com/bangjinhyuk/Tesseract_exam)
    + [ì„œë²„](https://github.com/bangjinhyuk/nodejs-mysql-STUDY)

1. ì•ˆë“œë¡œì´ë“œ ìŠ¤íŠœë””ì˜¤ `AndroidManifest.xml` ì„¤ì •

     ```xml
     <uses-permission android:name="android.permission.INTERNET" />
     <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
     <application
     ...
     android:usesCleartextTraffic="true">
     ```
 
2. `build.gradle`ì— Retrofit , okhttp3 ì¶”ê°€

    ```gradle
    implementation 'com.squareup.retrofit2:retrofit:2.9.0'
    implementation 'com.squareup.retrofit2:converter-gson:2.9.0'
    implementation com.squareup.retrofit2:converter-scalars:2.9.0'
    
    implementation 'com.squareup.okhttp3:okhttp:3.11.0'
    implementation 'com.squareup.okhttp3:logging-interceptor:3.11.0'
    ```
3. ì„œë²„ì™€ í†µì‹ í•  ë©”ì†Œë“œë“¤ì´ ë‹´ê¸´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì¤€ë‹¤
    ```java
    import java.util.Map;

    import retrofit2.Call;
    import retrofit2.http.Body;
    import retrofit2.http.GET;
    import retrofit2.http.POST;
    import retrofit2.http.Query;
    import retrofit2.http.QueryMap;

    public interface OcrFactory {
        @GET("ocr/connect") // <=ìš”ê¸° ì•ˆì— ë“¤ì–´ê°€ëŠ”ê²Œ ì„œë²„ path
        Call<String> connect(@Query("userEmail") String email);

        @GET("ocr/connecting") // <=ìš”ê¸° ì•ˆì— ë“¤ì–´ê°€ëŠ”ê²Œ ì„œë²„ path
        Call<Semester> connecting(@QueryMap Map<String, String> success);

        @POST("ocr/semester") // <=ìš”ê¸° ì•ˆì— ë“¤ì–´ê°€ëŠ”ê²Œ ì„œë²„ path
        Call<Res_semester> semester(@Body Req_semester user);
    }
    ```
    <span style="color:#7EBDCB">ì¸í„°í˜ì´ìŠ¤ì—ì„œ í†µì‹  ë¶€ë¶„ì—ì„œ ëŒ€ë¶€ë¶„ì˜ ë©”ì†Œë“œë“¤ì„ ë‹¤ ë„£ì„ìˆ˜ë¡ ê¹”ë”. </span>
    <span style="color:#7EBDCB">ë˜ëŠ” ê¸°ëŠ¥ë³„ë¡œ ë‚˜ëˆ„ì–´ ì¸í„°í˜ì´ìŠ¤ ë¶„ë¥˜ í•˜ê¸°.  </span>
4. í•˜ë‚˜ì˜ ì„œë²„ì™€ í†µì‹ ì„ ë‹´ë‹¹í•˜ëŠ” í•˜ë‚˜ì˜ Singletone í´ë˜ìŠ¤ ë§Œë“¤ê¸° 
    ```java
    import com.google.gson.Gson;
    import com.google.gson.GsonBuilder;

    import okhttp3.OkHttpClient;
    import okhttp3.logging.HttpLoggingInterceptor;
    import retrofit2.Retrofit;
    import retrofit2.converter.gson.GsonConverterFactory;
    import retrofit2.converter.scalars.ScalarsConverterFactory;

    public class Net {
        private static Net ourinstance = new Net();

        public static Net getInstance(){
            return ourinstance;
        }

        Gson gson = new GsonBuilder().setLenient().create();
        private Net(){
        }
        OkHttpClient client = new OkHttpClient.Builder().addInterceptor(httpLoggingInterceptor()).build();

        private Retrofit retrofit = new Retrofit.Builder()
                .baseUrl("") //<= ì„œë²„ ì£¼ì†Œê°’ ì…ë ¥
                .client(client) //<= OkHttpClient ì—°ë™
                .addConverterFactory(ScalarsConverterFactory.create()) //<= ê³ ì§ˆì ì¸ ì—ëŸ¬ :JSON document was not fully consumed í•´ê²°
                .addConverterFactory(GsonConverterFactory.create(gson))
                .build();
        OcrFactory ocrFactory;

        public OcrFactory getOcrFactory(){
            if(ocrFactory == null){
                ocrFactory = retrofit.create(OcrFactory.class);
            }
            return ocrFactory;
        }
        private HttpLoggingInterceptor httpLoggingInterceptor(){

            HttpLoggingInterceptor interceptor = new HttpLoggingInterceptor(new HttpLoggingInterceptor.Logger() {
                @Override
                public void log(String message) {
                    android.util.Log.e("MyLogis :", message + "");
                }
            });

            return interceptor.setLevel(HttpLoggingInterceptor.Level.BODY);
        }
    }
    ```
    * [.addConverterFactory(ScalarsConverterFactory.create()](https://stackoverflow.com/questions/42386250/android-retrofit-2-0-json-document-was-not-fully-consumed)
    * í•œ í´ë˜ìŠ¤ë¡œ í•˜ë‚˜ì˜ ë ˆíŠ¸ë¡œí• ê°ì²´ë¥¼ ë§Œë“¤ê¸° ë•Œë¬¸ì— í”„ë¡œì íŠ¸ ì „ì²´ì—ì„œ ì´ ê°ì²´ë§Œ ì‚¬ìš© 
    * getOcrFactory()ì™€ ê°™ì€ í•¨ìˆ˜ë“¤ë¡œ ê¸°ëŠ¥ë³„ë¡œ ì—¬ëŸ¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš© ê°€ëŠ¥
    * OkHttpClient ë¥¼ í†µí•´ HTTP ìš”ì²­/ì‘ë‹µì— ëŒ€í•œ ìƒì„¸í•œ ë‚´ìš© í™•ì¸ ê°€ëŠ¥  
            
5. í•™ê¸° ì‹œê°„í‘œ ë°ì´í„°ë¥¼ ë‹´ëŠ” Semester í´ë˜ìŠ¤ ì‘ì„±
    ```java
    public class Semester {
        private String major1,major2;
        private String Class1,Class2,Class3,Class4,Class5;


        public Semester(){
        }

        @Override
        public String toString(){
            return  "semester{" +
                    "major1='" + major1 + '\'' +
                    ", major2=" + major2 +
                    ", Class1='" + Class1 + '\'' +
                    ", Class2='" + Class2 + '\'' +
                    ", Class3='" + Class3 + '\'' +
                    ", Class4='" + Class4 + '\'' +
                    ", Class5='" + Class5 + '\'' +
                    '}';
        }
        public Semester(String major1, String major2, String Class1, String Class2, String Class3, String Class4, String Class5){
            this.major1= major1;
            this.major2 = major2;
            this.Class1 = Class1;
            this.Class2 = Class2;
            this.Class3 = Class3;
            this.Class4 = Class4;
            this.Class5 = Class5;
        }

        public String getClass1() {
            return Class1;
        }

        public void setClass1(String class1) {
            Class1 = class1;
        }

        public String getClass2() {
            return Class2;
        }

        public void setClass2(String class2) {
            Class2 = class2;
        }

        public String getClass3() {
            return Class3;
        }

        public void setClass3(String class3) {
            Class3 = class3;
        }

        public String getClass4() {
            return Class4;
        }

        public void setClass4(String class4) {
            Class4 = class4;
        }

        public String getClass5() {
            return Class5;
        }

        public void setClass5(String class5) {
            Class5 = class5;
        }

        public String getMajor1() {
            return major1;
        }

        public void setMajor1(String major1) {
            this.major1 = major1;
        }

        public String getMajor2() {
            return major2;
        }

        public void setMajor2(String major2) {
            this.major2 = major2;
        }
    }
    ```
    
6. ì•¡í‹°ë¹„í‹°ì—ì„œ Retrofit ì‚¬ìš©ë°©ë²•
    1.  connect í•¨ìˆ˜(GET, Res = String, Req = String )
    
        ```java
        Call<String> res = Net.getInstance().getOcrFactory().connect("bangjinhyuk");
           res.enqueue(new Callback<String>() {
               @Override
               public void onResponse(Call<String> call, Response<String> response) {
                   if(response.isSuccessful()){
                       if(response.body() != null){
                           String success = response.body().toString();
                           Log.d("Main í†µì‹ ", response.body().toString());
                       }else{
                           Log.e("Main í†µì‹ ", "ì‹¤íŒ¨ 1 response ë‚´ìš©ì´ ì—†ìŒ");
                       }
                   }else{
                       Log.e("Main í†µì‹ ", "ì‹¤íŒ¨ 2 ì„œë²„ ì—ëŸ¬");
                   }
               }

               @Override
               public void onFailure(Call<String> call, Throwable t) {
                   Log.e("Main í†µì‹ ", "ì‹¤íŒ¨ 3 í†µì‹  ì—ëŸ¬ "+t.getLocalizedMessage());
               }
           });
        ```
    2. connecting í•¨ìˆ˜ (GET, Res = String, Req = Map )
    
        ```java
        Map<String, String> map = new HashMap<String, String>();
                map.put("name","bbangi");
                map.put("birth", "0103");

        Call<Semester> res1 = Net.getInstance().getOcrFactory().connecting(map);
        res1.enqueue(new Callback<Semester>() {
            @Override
            public void onResponse(Call<Semester> call, Response<Semester> response) {
                if(response.isSuccessful()){
                    if(response.body() != null){
                        Semester semesters = response.body();
                        Log.d("Map í†µì‹ ", semesters.toString());
                    }else{
                        Log.e("Map í†µì‹ ", "ì‹¤íŒ¨ 1 response ë‚´ìš©ì´ ì—†ìŒ");
                    }
                }else{
                    Log.e("Map í†µì‹ ", "ì‹¤íŒ¨ 2 ì„œë²„ ì—ëŸ¬");
                }
            }

            @Override
            public void onFailure(Call<Semester> call, Throwable t) {
                Log.e("Map í†µì‹ ", "ì‹¤íŒ¨ 3 í†µì‹  ì—ëŸ¬ "+t.getLocalizedMessage());

            }
        });
        ```
    3. semester í•¨ìˆ˜ (POST, Res = Res_semester, Req = Req_semester)
        
        ```java
        Req_semester req_semester = new Req_semester();
          req_semester.setSemester(new Semester(
                  "ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼",
                  "ë¯¸ë””ì–´í•™ê³¼",
                  "ì»´êµ¬",
                  "ì°½ì†Œì…",
                  "ê¸°ì°½ê²½",
                  "",
                  ""
          ));
          Call<Res_semester> res2 = Net.getInstance().getOcrFactory().semester(req_semester);
          res2.enqueue(new Callback<Res_semester>() {
              @Override
              public void onResponse(Call<Res_semester> call, Response<Res_semester> response) {
                  if(response.isSuccessful()) {
                      if (response.body() != null) {
                          Res_semester res_semester = response.body();


                          Log.d("semester í†µì‹ ",res_semester.code+"");

                      } else {
                          Log.e("semester í†µì‹ ", "ì‹¤íŒ¨ 1 response ë‚´ìš©ì´ ì—†ìŒ");
                      }
                  }else{
                      Log.e("semester í†µì‹ ", "ì‹¤íŒ¨ 2 ì„œë²„ ì—ëŸ¬");
                  }
              }

              @Override
              public void onFailure(Call<Res_semester> call, Throwable t) {

                  Log.e("semester í†µì‹ ", "ì‹¤íŒ¨ 3 í†µì‹  ì—ëŸ¬ "+t.getLocalizedMessage());

              }
          });
          ```
        + Req,Res í´ë˜ìŠ¤
        
            ```java
            class Res_semester {

                int code; //ì„œë²„ë¡œë¶€í„°ì˜ ì‘ë‹µ ì½”ë“œ. 404, 500, 200 ë“±.
                String msg; //ì„œë²„ë¡œë¶€í„°ì˜ ì‘ë‹µ ë©”ì„¸ì§€.
                Semester semester; //ê³µë¶€í•„ìš”.

            }
            class Req_semester {


                Semester semester;


                public Semester getSemester() {
                    return semester;
                }

                public void setSemester(Semester semester) {
                    this.semester = semester;
                }

            }
            ```
            
    * ì„œë²„ì—ì„œ ì˜¬ë°”ë¥¸ ê°’ì´ ì™”ì„ë•Œ response.isSuccessful() ëŠ” ì°¸
    
6. ì„œë²„ìª½  `ocr.js` íŒŒì¼ ì‘ì„±
    ```javascript
    var express = require('express');
    var router = express.Router();


    /* GET ocr listing. */
    router.get('/connect', function(req, res, next) {
      if(req.query.userEmail == 'bangjinhyuk'){
        res.send('connect all sucess');
      }else{
        res.send('connect little sucess');
      }
      
    });

    /* GET ocr listing. */
    router.get('/connecting', function(req, res, next) {
      if(req.query.name == 'bbangi' && req.query.birth == '0103'){
        res.send(JSON.stringify(
            {"major1":"ì†Œì›¨", 
            "major2": "ë¯¸ë””ì–´", 
            "Class1":"1",
            "Class2":"2",
            "Class3":"3",
            "Class4":"4",
            "Class5":"5"}));
      }else{
        res.send('connecting little sucess');
      }
      
    });

    /* GET ocr listing. */
    router.post('/semester', function(req, res, next) {
      res.send('{"code":-1, "msg": "failed"}');
      // if(req.body.semester == 'bbangi' && req.query.birth == '0103' ){
      //   res.send('connecting all sucess');
      // }else{
      //   res.send('connecting little sucess');
      // }
      
    });

    /* GET ocr listing. */
    router.get('/', function(req, res, next) {
      // res.send(req.body.userEmail);
      
        res.send('connect');
      });


    module.exports = router;
    ```
    
+ ì°¸ì¡° ì‚¬ì´íŠ¸
    * [Retrofit nodes ì˜ˆì‹œ1](https://uareuni.tistory.com/29)
    * [Retrofit nodes ì˜ˆì‹œ2](https://m.blog.naver.com/PostView.nhn?blogId=eyeballss&logNo=221043096972&proxyReferer=https:%2F%2Fwww.google.com%2F)
    * [Retrofit nodes ì˜ˆì‹œ3](https://imcreator.tistory.com/90)
    * [req ê°ì²´ì™€ res ê°ì²´, ê·¸ë¦¬ê³  res.sendì™€ res.jsonì˜ ë¹„êµ](https://uhou.tistory.com/102)
    * [Retrofit ì´ìŠˆ](https://yujuwon.tistory.com/entry/retrofit-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0)
    * [GET-POST ì°¨ì´](https://blog.outsider.ne.kr/312)
    * [ì½œë°± í•¨ìˆ˜ ê°œë…](https://www.hanumoka.net/2018/10/24/javascript-20181024-javascript-callback/)
    * [ìµëª…í•¨ìˆ˜ ê°œë…](https://dasima.xyz/javascript-anonymous-function/)
    * [ì—¬ëŸ¬ í•¨ìˆ˜ í˜¸ì¶œ ë°©ì‹](https://deftkang.tistory.com/19)
    * [ì½œë¡  ì˜ë¯¸](http://roomycode.blogspot.com/2016/09/jquery.html)
    
[ë§¨ìœ„ë¡œğŸ‘†](#){: .btn .btn--primary }
